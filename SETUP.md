# Setup
## Installing CGAL on Mac
- brew install cgal  
<a/>
  
Go to where cgal is located, mine was /usr/local/Cellar/cgal/5.3  
- cgal_create_CMakeLists 
- mkdir build     
- cd build  
- cmake ..  
<a/>
  
Now the build files should have been written to /usr/local/Cellar/cgal/5.3/build  
- cd ..  
- cmake -DCGAL_DIR=$CMAKE_INSTALLED_PREFIX/lib/CGAL -DCMAKE_BUILD_TYPE=Release .  
- make  
  
#### Testing CGAL
- cgal_create_CMakeLists -s my_test  
- make my_test  
#### Writing your own CGAL program
- cgal_create_CMakeLists  
- cmake -DCGAL_DIR=$CMAKE_INSTALLED_PREFIX/lib/CGAL -DCMAKE_BUILD_TYPE=Release .  
- make  
- cgal_create_CMakeLists -s my_program  
- make my_program  
- ./my_program  
  
## Installing Qt5 and linking with program  
- brew install qt5 
Go to where qt5 is located, mine was /usr/local/Cellar/qt@5/5.15.2  
- cgal_create_CMakeLists  
- mkdir build  
- cd build  
- cmake ..  
<a/>
  
Now the build files should have been written to /usr/local/Cellar/qt@5/5.15.2/build  
- cd ..  
- cmake -DCGAL_DIR=$CMAKE_INSTALLED_PREFIX/lib/CGAL -DCMAKE_BUILD_TYPE=Release .  
- make  
#### Editing CMakeLists.txt file to include Qt5 libraries  
The barebones CMakeLists.txt file is generated with the command:  
- cgal_create_CMakeLists  
<a/>
  
However, when we want to tell cmake to add other libraries, we need to specify them in manually in CMakeLists.txt. For simple polygon visualization, Qt5 is used. We have to tell cmake where to get the pakage components and libraries of Qt5, and then how to link them with our final executable. First, we find Qt5 and its components:
- find_package( CGAL REQUIRED OPTIONAL_COMPONENTS Qt5 )  
<a/>
  
Next, we add the CGAL keyword -DCGAL_USE_BASIC_VIEWER  
- if(CGAL_Qt5_FOUND)  
  
  - add_definitions(-DCGAL_USE_BASIC_VIEWER -DQT_NO_KEYWORDS)  
  
- endif()  
<a/>
  
Now we can utilize CGAL headers such as <CGAL/draw_polygon_2.h> and <CGAL/draw_polygon_with_holes_2.h>  
## Installing OpenCV and linking with program  
- brew install opencv  
<a/>
  
Go to where opencv is located, mine was /usr/local/Cellar/opencv/4.5.3_2  
- cgal_create_CMakeLists  
- mkdir build  
- cd build  
- cmake ..  
<a/>
  
Now the build files should have been written to /usr/local/Cellar/opencv/4.5.3_2/build  
- make  
#### Editing CMakeLists.txt file to include OpenCV libraries  
OpenCV installs differently from Boost, CGAL, Qt5, etc. First, we need to set the OpenCV_DIR variable to the path of the cmake files, which on my machine is:  
- set(OpenCV_DIR /usr/local/Cellar/opencv/4.5.3_2/lib/cmake/opencv4)  
<a/>
  
Next we tell cmake to find OpenCV and its components:  
- find_package( OpenCV REQUIRED )  
<a/>
  
We then tell the build to include the headers from OpenCV:  
- include_directories( ${OpenCV_INCLUDE_DIRS} )  
<a/>
  
Finally we tell cmake to link the executable target against OpenCV  
- target_link_libraries(packer PUBLIC ${OpenCV_LIBS})  
<a/>
  
Now we can use OpenCV in the program.

# CGAL source files editing
## Random polygon generation
Packer relies on a random polygon generator function to produce random nest objects when an input file is not provided. The exact function being used is CGAL::random_polygon_2 which exists in random_polygon_2.h. This script, along with CGAL/Polygon_2_algorithms_impl.h and CGAL/Random_polygon_2_sweep.h must be edited slightly to ensure that the polygon generation does not get stuck in an infinite looop which will be disussed shortly.  

First in CGAL/Random_polygon_2.h, line 73 was commented out to yield:  
- //CGAL_assertion(is_simple_2(vertices.begin(), vertices.end()));  
<a/>
  
Next, in CGAL/Polygon_2_algorithms_impl.h, line 510 was commented out to yield:
- //CGAL_polygon_precondition(is_simple_2(first, last, traits));  
<a/>
  
Since we are going to manually check each polygon for simplicity, these assertions are redundant and therefore unneeded. The culprit of the bug in the program is in CGAL/Random_polgon_2_sweep.h. Specifically, the issue is in the function make_simple_polygon, which contains a while loop that will never end. This occurs because the swap interval to ensure simplicity generated by check_simple_polygon can sometimes ensure that the polygon will never be simple. To fix this, we simply break the loop if it takes too long to make the polygon simple. First, add the following on line 29:  
- #include <time.h>  
<a/>
  
Next, go to line 609, right before the do {} while(true) block and add:  
- time_t start = time(0);  
<a/>
  
Finally, add the following block at the end of the while loop, on line 634:  
- if (difftime(time(0), start) > .01){  
  - break;  
- }  
<a/>
  
These adjustments will ensure that the loop breaks after 0.01 seconds no matter what. This is an ample amount of time to execute this while loop. If the loop is broken, that almost guarantees that the resulting generated polygon will not be simple, which is obviously a big problem for later geometric calculations. However, in packer/get_random_polygons, we check if the generated polygon is simple, if not, we simply regenerate.

# Edit repository
The only line in the repository that needs to be ediited is line 140 in src/visualize.cpp. Change the file path to whatever you want, I set mine to my desktop.
